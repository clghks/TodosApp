<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    <div id="app">

    </div>

    <input type="button" value="추가" onclick="addTodoItem()"/>
    <input type="button" value="삭제" onclick="remvoeTodoItem()"/>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script>
        // todo 리스트 출력
        var TodoItem = Backbone.Model.extend({
            url:'/todos'
        });

        var TodoList = Backbone.Collection.extend({
            url:'/todos'
        });

        var TodoView = Backbone.View.extend({
            template: _.template('<input type=checkbox /><%= description %>'),
            reander: function(){
                var attributes = this.model.toJSON();
                $(this.el).html(this.template(attributes));
                return this;
            }
        })

        var TodoListView = Backbone.View.extend({
            initialize: function(){
              this.collection.on('reset', this.addAll(), this);
            },
            reander: function(){
                this.addAll();
            },
            addOn: function(todoItem){
                var todoView = new TodoView({model:todoItem});
                this.$el.append(todoView.reander().el);
            },
            addAll: function(){
                this.collection.forEach(this.addOn, this);
            },
            remove: function(){
//                this.$el[0].remove();
                this.$el.html('');
            }
            /*
            refresh: function(){
                this.collection.fetch({
                    success: reander
                });
            }
            */
        });

        var todoList = new TodoList();
        var todoListView = new TodoListView({collection:todoList});
        getTodoItem();

        function getTodoItem(){
            todoList.fetch({
                success: function(){
                    todoListView.remove();
                    todoListView.reander();
                    $("#app").html(todoListView.el);
                }
            });
        }

        // todo 추가 삭제
        // todo 추가
        function addTodoItem(){
            var todoItem = new TodoItem({description: 'Test7', status: 'incomplete'});
            todoItem.save();
            getTodoItem();
        }

        // todo 삭제
        function remvoeTodoItem(){
            var todoItem = todoList.unshift();
            todoItem.destroy();
            getTodoItem();
        }



    </script>
</body>
</html>